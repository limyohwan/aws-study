# EC2(Elastic Compute Cloud)

### EC2 개요
- AWS 클라우드 컴퓨팅 서비스 = 클라우드 가상 서버(Virtual Machine)
- EC2 클라우드 가상 서버를 `인스턴스`라고 부름

### EC2 생성 절차
1. 이름 및 태그
2. 애플리케이션 및 운영체제 이미지
3. 인스턴스 유형
4. 키 페어
5. 네트워크 설정
6. 스토리지 구성
7. 고급 세부 정보

### EC2 원격 접속
- Secure Shell Protocol(SSH)를 사용한 연결
- 원격 데스크톱 프로토콜(RDP)를 사용한 연결
- EC2 Instance Connect를 사용한 연결(AWS 제공)
- AWS Systems Manager 세션 관리자(Session Manager)를 사용한 연결(AWS 제공)

### EC2 instance 역할
- IAMReadOnlyAccess 권한 부여 후 인스턴스 콘솔에서 밑의 명령어 살향
- aws iam list-roles
- aws iam list-users

### Elastic Network Interface(ENI)
- 가상 네트워크 인터페이스
- IP주소, MAC 주소 등이 부여됨
- 인스턴스에 연결되어 네트워크 통신을 하는 역할
- 인스턴스 생성시 기본 네트워크 인터페이스가 IP 주소 등의 정보 할당과 함꼐 생성됨
- EC2에 추가로 여러 개의 네트워크 인터페이스 연결 가능

### ENI - Public IP vs. Private IP
- 퍼블릭 IP : 인터넷 연결에 사용하는 IP
- 프라이빗 IP : 회사나 집의 내부에서만 사용하는 IP, 직접적으로 인터넷 연결이 안되며 인터넷 게이트웨이를 통해야 함

### ENI - 탄력적 IP(Elastice IP)
- 인스턴스 생성시 자동으로 할당 받은 public IP는 인스턴스를 재시작 하면 다른 IP로 재할당 받기에 public IP 주소가 변경됨
- Elastic IP는 인터넷에 연결 가능한 고정적(정적)인 퍼블릭 IP 주소
- EC2 인스턴스의 ENI에 탄력적 IP주소를 연결하면 EC2 인스턴스를 다시 시작해도 동일한 IP 주소로 접속할 수 있음
- 사용하지 않아도 IP 주소에 대한 비용이 청구 됨

### 보안그룹
- EC2 인스턴스에 대한 인바운드 및 아웃바운드 트래픽을 제어하는 인스턴스 수준의 방화벽
- EC2 인스턴스의 ENI와 연결됨
- 보안 그룹은 허용 규칙만 지정 가능하고 거부 규칙은 지정할 수 없음

### 보안그룹 명칭 정리
- 인바운드 트래픽 : 외부에서 EC2 인스턴스로 들어오는 트래픽(디폴트 값은 허용되어 있는 규칙이 없음)
- 아웃바운드 트래픽 : EC2 인스턴스에서 외부로 나가는 트래픽(디폴트 값은 모두 허용 되어 있음)
- 제어 규칙
    - 트래픽 유형(SSH, HTTP 등)
    - 프로토콜(TCP, UDP 등)
    - 포트(SSH 22, HTTP 80, HTTPS 443, RDP 3389 등)
    - 대상(개별 IP 주소, IP 주소대역, 다른 보안 그룹)

### 인스턴스 구매 옵션
- 온디맨트 인스턴스 : 약정 없이 초당 사용한 만큼 비용 지불
    - 사용한 만큼만 비용을 지불
    - 처음 60초 이후 초당 과금
    - 장기 약정이나 선 결제 x
    - 단기간 동안 예측할 수 없는 워크로드 및 중단되어서는 안되는 애플리케이션에 적합
    - EC2에서 처음으로 개발 중이거나 시험 중인 애플리케이션 사용에 적합
- 스팟 인스턴스 : 사용 안하는 인스턴스를 경매 방식으로 구매하여 사용
    - 온디맨드 인스턴스보다 최대 90퍼 저렴
    - 경매 조건에 미달하면 인스턴스가 정지 또는 종료 되므로 언제든지 시작 및 종료가 가능한 경우에 사용
    - 언제든 인스턴스가 종료될 수 있기 때문에 서버가 중단없이 지속적으로 실행 되어야하는 경우 사용 안함
    - 여러 개의 스팟 인스턴스를 하나의 그룹으로 묶어 스팟 집합(Spot Fleets)으로 구매해서 사용
    - 예약 인스턴스 + 스팟 인스턴스(짧은 시간 급격하게 증가된 용량이 필요한 경우)의 조합으로 사용
- 예약 인스턴스 : 1년 또는 3년 기간을 약정하여 인스턴스를 사용
    - 온디맨드에 비해 최대 75퍼 저렴
    - 수요가 꾸준하고 예측가능한 경우에 유용
    - 결제옵션은 전체 선결제, 부분 선결제, 선결제 없음 3가지 선택 가능
    - 선택가능한 예약 인스턴스 유형
        - 표준 예약 인스턴스
        - 전환형 예약 인스턴스
        - 정기 예약 인스턴스
- Saving Plan : 1년 또는 3년 기간의 일정 사용량을 약정하여 시간당 요금으로 인스턴스를 사용
    - EC2 뿐만 아니라 Lambda 및 Fargate 서비스도 사용 가능
    - 사용량은 시간당 USD 요금으로 측정
    - 온디맨드에 비해 최대 66~72퍼 저렴
    - Compute Saving Plans와 EC2 Instance Saving Plans 두가지 유형이 있음
    - 예약 인스턴스와 달리 EC2 인스턴스 패밀리, 사이즈, 리전, OS 관계없이 적용 및 변경 가능한 유연성이 있음
- 전용 호스트/전용 인스턴스 : 전용 물리적 서버를 할당 받아서 인스턴스를 사용
    - 전용 호스트
        - 물리적인 전용 서버를 할당 받아 사용하는 방식
        - CPU 소켓, 코어 등이 표시 됨
        - 사용자가 인스턴스 배치 방법을 지정할 수 있음
        - 소켓당, 코어당 또는 VM 당으로 사용하는 소프트웨어 라이선스 사용 가능
        - CPU 코어나 물리적 서버에 할당되는 라이선스를 기존에 보유한 경우에 적합
    - 전용 인스턴스
        - 물리적인 전용 서버를 할당 받아 사용하는 방식
        - 전용 호스트에서 사용가능한 CPU코어, 인스턴스 배치, 사용자 라이선스 사용 불가

### 인스턴스 유형
- 인스턴스를 생성할 때 지정하는 인스턴스 유형에 따라 컴퓨터 하드웨어가 결정
- 인스턴스 유형은 CPU, 메모리, 스토리지 및 네트워킹 용량의 여러 조합으로 구성됨
- 애플리케이션에 따라 적합한 유형을 선태갛여 인스턴스를 시작
- 인스턴스 유형은 목적에 따라 범용, 컴퓨팅 최적화, 메모리 최적화, 가속화된 컴퓨팅, 스토리지 최적화의 인스턴스 패밀리로 분류됨