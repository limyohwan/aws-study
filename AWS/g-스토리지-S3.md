# 스토리지 - S3(Amazon Simple Storage Service)

### 데이터 저장 방식
- 오브젝트 스토리지
    - 오브젝트라고 불리는 개별 유닛에 데이터를 저장하는 스토리지 포맷
    - 각 유닛의 고유 식별자 혹은 키를 가지고 데이터를 찾음
    - Amanzon S3
- 블록 스토리지
    - 데이터를 고정된 사이즈의 블록으로 나누어 고유한 식별자와 함께 저장
    - Amazon EBS
- 파일 스토리지
    - 계층적 파일 디렉터리 내의 폴더에서 파일로 저장
    - 해당 데이터에 엑세스 할경우 경로를 알아야함
    - Amazon EFS, FSx

### S3 개요, 버킷 및 객체
- 거의 무제한 저장용량을 제공하는 객체 스토리지 서비스
- 최소 3개의 가용영역에 데이터를 자동으로 분산 저장하기에 성능, 확장성, 가용성, 내구성이 높음
- 백업 및 복원, 재해 복구(DR), 아카이브, 클라우드 스토리지, 정적 웹사이트 호스팅 등 사용
- 버킷(Bucket) : 오브젝트 저장공간, 버킷은 리전 단위로 생성, 버킷이름은 유니크 해야함
- 객체(Object) : 오브젝트(파일), 개별 오브젝트 최대 사이즈는 5TB

### S3 버전 관리
- 객체(파일)는 여러 버전을 가질 수 있음
- 동일한 파일 이름을 업로드하면 여러 버전으로 저장됨(v1, v2 등)
- 실수로 객체를 덮어쓰거나 삭제한 경우 이전 버전으로 복구 가능
- 실수로 객체를 삭제 하는 것을 방지하기 위해 MFA Delete 옵션을 추가할 수 있음 (버전관리 + MFA Delete를 조합하면 삭제 방지가 더 강력함)
- 버전관리 기능을 사용하려면 해당 기능을 활성화 해야함

### S3 객체 암호화
- 데이터를 전송 중, 스토리지에 저장된 동안 보호하기 위해 암호화 사용
- 서버 측 암호화(Server Side Encryption) : 데이터가 서버에 저장되기 전에 객체를 암호화
    - SSE - S3 : S3에서 관리하는 암호화
    - SSE - KMS : KMS(키 관리 서버)에서 관리하는 암호화, 키 자동 교체 혹은 감사기능 지원 가능
    - SSE - C : C(고객)가 관리하는 암호화, 반드시 HTTPS 사용
- 클라이언트 측 암호화 : 데이터를 전송하기 전 클라이언트 사이드에서 암호화
- 전송 중 암호화 : SSL/TLS를 이용해 데이터를 암호화, HTTPS를 사용하여 전송

### S3 버킷 정책
- 버킷 정책
    - S3 버킷 액세스 제어 정책
    - JSON 형식
    - 조건에 따라 버킷에 액세스를 부여하고 제한하는 기능으로 사용(특정 AWS 리소스에서만 S3 버킷에 액세스 허용)
    - 다른 AWS계정에 버킷 액세스 권한을 부여 가능(교차 계정 액세스 권한)
- 퍼블릭 액세스 차단(버킷 설정)
    - 버킷과 객체에 대한 퍼블릭 액세스를 차단하거나 허용
    - 데이터 보호를 위해 기본적으로 차단됨
- ACL(액세스 제어 목록)
    - AWS 계정에 버킷이나 객체에 읽기/쓰기 권한을 부여하는 기능
    - 버킷 레벨에서 ACL을 적용하거나 객체 레벨에서 ACL을 적용 가능

### S3 정적 웹사이트 호스팅
- S3에서 웹사이트 호스팅을 하면 EC2 등의 별도의 웹서버를 운영하지 않아도 됨
- 웹사이트 주소는 버킷이름.s3-website-리전.amazonaws.com 형식
- 사이트 접속시 403에러 발생하면 버킷의 퍼블릭 액세스 헝용을 해주면 됨

### 액세스 로깅
- S3 버킷의 모든활동을 파일로 만들어 S3 버킷에 저장하는 기능
- 감사 목적으로 활용 가능
- 로그 분석을 위해 Amazon Athena 같은 분석 도구 사용 가능
- 절대로 로그 파일 저장소를 같은 버킷에 하면 안됨(무한루프로 인해 로그파일 무한 증가)

### S3 Replication(복제 규칙)
- S3 버킷 간에 객체를 자동으로 복제하는 기능
- 2가지 복제 유형
    - 교차 리전 복제(Cross Region Replication)
        - 서로 다른 AWS 리전의 S3 버킷으로 객체를 복사(지리적으로 가까운 액세스가 필요한 경우 재해복구(DR))
    - 동일 리전 복제(Same Region Replication)
        - 같은 AWS 리전의 S3 버킷으로 객체를 복사(동일한 데이터를 사용하는 프로덕션과 테스트 계정 간의 복제, 법적 준수사항으로 같은 리전 안에 데이터 복사본을 만들어 놓아야 하는 경우)
- 버킷 복제를 위해서는 원본과 대상 버킷 모두 버전 관리가 활성화되어 있어야 함
- 다른 AWS 계정의 버킷으로도 복제 가능

### 스토리지 클래스
|스토리지 클래스|다음 용도로 설계됨|가용 영역|최소 스토리지 기간|
|:---:|:---:|:---:|:---:|
|standard|자주 액세스 하는 데이터|>= 3| - |
|지능형 계층화(Intelligent-Tiering)|액세스 패턴이 바뀌거나 알 수 없는 데이터|>= 3| - |
|Standard-IA|자주 액세스하지 않는 데이터|>= 3|30일|
|One Zone-IA|단일 가용 영역에 저장되는 재생성 가능하고 자주 액세스하지 않는 데이터|1|30일|
|Glacier Instant Retrieval|분기에 한 번 액세스하는 오래된 아카이브 데이터|>= 3|90일|
|Glacier Flexible Retrieval|일 년에 한 번 액세스하는 오래된 아카이브 데이터|>= 3|90일|
|Glacier Deep Archive|일 년에 한 번 미만으로 액세스하는 오래된 아카이브 데이터|>= 3|180일|

### 객체 수명주기 관리(Lifecycle Policy)
- 객체가 저장되어 삭제될 때까지의 수명 주기를 비용 효율적으로 저장 되도록 관리하는 기능
- 버전 관리가 활성화 되어 있을 경우 객체의 버전별로 수명 주기 정책을 적용할 수 있음